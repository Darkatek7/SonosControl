@page "/"
@using System.Text.RegularExpressions
@using SonosControl.Web.Data
@inject ApplicationDbContext Db
@using SonosControl.Web.Models;
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject IJSRuntime JS
@inject NavigationManager Navigation
@attribute [Authorize(Roles = "admin,operator,superadmin")]

<PageTitle>Sonos Control</PageTitle>


    @if (_settings is not null)
    {
            <div class="container p-4 bg-dark text-light rounded-4 shadow">
                <h3 class="mb-4 border-bottom pb-2">🎛️ Sonos Control Panel</h3>

                <!-- Playback Status -->
                <div class="mb-4">
                    <div class="@($"card playback-card shadow-sm border-0 rounded-4 text-white {(!_isPlaying ? "paused" : string.Empty)}")" style="@PlaybackCardStyle">
                        <div class="card-body">
                            <div class="d-flex flex-column gap-3">
                                <div class="d-flex flex-column flex-lg-row align-items-start gap-3">
                                    <div class="d-flex align-items-start gap-3 flex-grow-1">
                                        <div class="playback-icon">
                                            <i class="fa fa-music"></i>
                                        </div>
                                        <div class="playback-text">
                                            <h5 class="mb-1">@(_isPlaying ? "Now Playing" : "Playback Paused")</h5>
                                            <p class="mb-0">@(_isPlaying ? "Click to pause playback." : "Click to start playing music.")</p>
                                        </div>
                                    </div>
                                    @{
                                        var playbackToggleLabel = _isPlaying ? "Pause playback" : "Start playback";
                                    }
                                    <div class="playback-actions d-flex align-items-center flex-wrap gap-2 ms-auto">
                                        <button class="btn btn-light text-dark playback-action"
                                                @onclick="() => Play(!_isPlaying)"
                                                title="@playbackToggleLabel"
                                                aria-label="@playbackToggleLabel">
                                            <i class="fa @(_isPlaying ? "fa-pause" : "fa-play")"></i>
                                        </button>
                                        <button class="btn btn-outline-light playback-action"
                                                @onclick="OpenTimerModal"
                                                title="Schedule playback"
                                                aria-label="Schedule playback">
                                            <i class="fa fa-clock-o"></i>
                                        </button>
                                        @if (_isPlaying && _isSpotifyPlaying)
                                        {
                                            <button class="btn btn-outline-light playback-action"
                                                    @onclick="NextTrack"
                                                    title="Skip track"
                                                    aria-label="Skip track">
                                                <i class="fa fa-forward"></i>
                                            </button>
                                        }
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <div class="playback-volume-control">
                                        <i class="fa fa-volume-up"></i>
                                        <input type="range"
                                               class="form-range playback-volume-slider"
                                               min="0" max="@MaxVolumeLimit"
                                               @bind-value="Volume"
                                               @bind-value:event="oninput"
                                               aria-label="Volume" />
                                        <span class="playback-volume-value">@($"{Volume}%")</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @if (_timerEndTimeUtc is not null)
                {
                    var localStopTime = _timerEndTimeUtc.Value.ToLocalTime();
                    <div class="alert alert-info timed-playback-alert d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <strong>Timed Playback Active</strong>
                            <p class="mb-0">@(_timerSelectionName ?? "Playback") will stop at @localStopTime.ToString("t").</p>
                        </div>
                        <button type="button" class="btn btn-sm timed-playback-cancel btn-inline" @onclick="CancelTimedPlayback">Cancel</button>
                    </div>
                }

                <!-- Now Playing Card -->
                <div class="card bg-secondary text-white mb-4 shadow-sm border-0 rounded-4">
                    <div class="card-body d-flex align-items-start gap-3">
                        <div class="display-5">🎵</div>
                        <div class="flex-grow-1 text-wrap">
                            <h5 class="mb-2">Currently Playing</h5>
                            <p class="mb-1 text-light-emphasis currently-playing-text text-break">
                                <strong>Station:</strong> @currentStationDisplay
                            </p>
                            <p class="mb-0 text-light-emphasis currently-playing-text text-break">
                                <strong>Track:</strong> @currentlyPlaying
                            </p>
                            @if (!string.IsNullOrWhiteSpace(trackProgress))
                            {
                                <p class="mb-0 text-light-emphasis currently-playing-text text-break">
                                    <strong>Time:</strong> @trackProgress
                                </p>
                            }
                        </div>
                    </div>
                </div>


                <!-- Queue Section -->
                <div class="card bg-secondary text-white mb-4 shadow-sm border-0 rounded-4">
                    <div class="card-header bg-secondary border-0 d-flex flex-wrap justify-content-between align-items-center gap-2">
                        <h5 class="mb-0">Playback Queue</h5>
                        <div class="d-flex flex-wrap align-items-center gap-2">
                            <div class="d-flex align-items-center gap-2">
                                <label class="form-label mb-0 small text-light-emphasis" for="queueRefreshInterval">Refresh every</label>
                                <select id="queueRefreshInterval"
                                        class="form-select form-select-sm bg-dark text-white border-0"
                                        value="@_queueRefreshIntervalSeconds"
                                        @onchange="OnQueueRefreshIntervalChanged"
                                        aria-label="Queue auto refresh interval">
                                    @foreach (var option in _queueRefreshIntervals)
                                    {
                                        <option value="@option">@option s</option>
                                    }
                                </select>
                            </div>
                            <div class="form-check form-switch m-0">
                                <input class="form-check-input"
                                       type="checkbox"
                                       role="switch"
                                       id="queueAutoRefreshSwitch"
                                       @bind="QueueAutoRefreshEnabled"
                                       aria-label="Toggle queue auto refresh" />
                                <label class="form-check-label small" for="queueAutoRefreshSwitch">Auto</label>
                            </div>
                            <button class="btn btn-outline-light btn-sm d-flex align-items-center gap-1"
                                    @onclick="() => LoadQueue(reset: true)"
                                    disabled="@_queueIsLoading"
                                    aria-label="Refresh queue now">
                                <i class="fa fa-refresh @(_queueIsLoading ? "fa-spin" : string.Empty)"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        @if (!string.IsNullOrEmpty(_queueErrorMessage))
                        {
                            <div class="alert alert-warning m-3" role="alert">@_queueErrorMessage</div>
                        }

                        <div class="queue-list-container">
                            @if (_queueIsLoading && !queue.Any())
                            {
                                <div class="text-center py-4 text-light-emphasis">
                                    <div class="spinner-border text-light" role="status">
                                        <span class="visually-hidden">Loading queue…</span>
                                    </div>
                                </div>
                            }
                            else if (!queue.Any())
                            {
                                <p class="text-light-emphasis text-center py-4 mb-0">Queue is empty.</p>
                            }
                            else
                            {
                                <ul class="list-group queue-list">
                                    @foreach (var item in queue)
                                    {
                                        <li class="list-group-item bg-dark text-white d-flex align-items-start justify-content-between gap-3"
                                            data-qa="queue-item">
                                            <div class="flex-grow-1 text-truncate">
                                                <div class="fw-semibold text-truncate">@FormatQueueItem(item)</div>
                                                @if (!string.IsNullOrWhiteSpace(item.Album))
                                                {
                                                    <div class="small text-light-emphasis text-truncate">@item.Album</div>
                                                }
                                            </div>
                                            <span class="badge bg-secondary align-self-center">@((item.Index + 1).ToString("D2"))</span>
                                        </li>
                                    }
                                </ul>

                                @if (_queueHasMore)
                                {
                                    <div class="p-3 text-center">
                                        <button class="btn btn-outline-light btn-sm"
                                                @onclick="LoadNextQueuePage"
                                                disabled="@_queueIsLoading"
                                                aria-label="Load more queue items">
                                            @(_queueIsLoading ? "Loading…" : "Load more")
                                        </button>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>



                <!-- TuneIn Station Section -->
                <div class="form-section mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">📻 TuneIn Stations</h5>
                        <div class="d-flex align-items-center gap-2">
                            <button
                                class="btn btn-primary btn-sm px-2 py-1"
                                style="font-size: 0.75rem; width: auto; margin-top: 0;"
                                @onclick="ShuffleStation"
                                title="Shuffle stations"
                                aria-label="Shuffle stations">
                                🔀
                            </button>
                            <button
                                class="btn btn-outline-light btn-sm d-flex align-items-center px-2 py-1 gap-1"
                                style="white-space: nowrap; font-size: 0.75rem; width: auto; margin-top: 0;"
                                @onclick="() => isEditMode = !isEditMode">
                                <i class="fa fa-pencil"></i>
                                @(isEditMode ? "Done" : "Edit")
                            </button>
                        </div>
                    </div>

                    @if (isEditMode)
                    {
                        @if (!string.IsNullOrEmpty(addStationErrorMessage))
                        {
                            <div class="alert alert-danger">@addStationErrorMessage</div>
                        }

                        <div class="mb-3">
                            <h6>Add New Station</h6>
                            <div class="mb-2">
                                <label>Station Name</label>
                                <input class="form-control bg-secondary text-light border-0"
                                       @bind="newStationName" @bind:event="oninput"
                                       placeholder="Antenne Vorarlberg"/>
                            </div>
                            <div class="mb-2">
                                <label>Station URL</label>
                                <input class="form-control bg-secondary text-light border-0"
                                       @bind="newStationUrl" @bind:event="oninput"
                                       placeholder="web.radio.example.com/stream"
                                       pattern="@stationUrlPattern"/>
                            </div>
                            <button class="btn btn-success mt-2" @onclick="AddStation" disabled="@(!CanAddStation)">
                                Add Station
                            </button>
                        </div>

                        <ul class="list-group">
                            @foreach (var station in _stations)
                            {
                                <li class="list-group-item bg-dark text-white px-3 py-2">
                                    <div class="row align-items-center">
                                        <div class="col-10 text-truncate">
                                            @(station.Name.Length > 33 ? station.Name.Substring(0, 33) + "..." : station.Name)
                                        </div>
                                        <div class="col-2 text-end">
                                            <button class="btn btn-sm btn-outline-danger px-2 py-1 station-remove-btn"
                                                    title="Remove"
                                                    @onclick="() => RemoveStation(station)">
                                                <i class="fa fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <select class="form-select bg-secondary text-light border-0 mt-2" @bind="selectedStation">
                            <option value="">-- Select Station --</option>
                            @foreach (var station in _stations)
                            {
                                <option
                                    value="@station.Url">@(station.Name.Length > 33 ? station.Name.Substring(0, 33) + "..." : station.Name)</option>
                            }
                        </select>
                    }
                </div>

                <!-- Spotify Tracks Section -->
                <div class="form-section">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">🎶 Spotify Tracks</h5>
                        <button
                            class="btn btn-outline-light btn-sm d-flex align-items-center px-2 py-1 gap-1"
                            style="white-space: nowrap; font-size: 0.75rem; width: auto; margin-top: 0;"
                            @onclick="() => isSpotifyEditMode = !isSpotifyEditMode">
                            <i class="fa fa-pencil"></i>
                            @(isSpotifyEditMode ? "Done" : "Edit")
                        </button>
                    </div>

                    @if (isSpotifyEditMode)
                    {
                        @if (!string.IsNullOrEmpty(addTrackErrorMessage))
                        {
                            <div class="alert alert-danger">@addTrackErrorMessage</div>
                        }

                        <ul class="list-group mb-3">
                            @foreach (var track in _tracks)
                            {
                                <li class="list-group-item bg-dark text-white px-3 py-2">
                                    <div class="row align-items-center">
                                        <div class="col-10 text-truncate">
                                            @track.Name
                                        </div>
                                        <div class="col-2 text-end">
                                            <button class="btn btn-sm btn-outline-danger px-2 py-1 station-remove-btn"
                                                    title="Remove"
                                                    @onclick="() => RemoveSpotifyTrack(track)">
                                                <i class="fa fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </li>
                            }
                        </ul>

                        <div>
                            <div class="mb-2">
                                <label>Name</label>
                                <input class="form-control bg-secondary text-light border-0"
                                       @bind="newTrackName" @bind:event="oninput"
                                       placeholder="Crunchyroll Anime Essentials"/>
                            </div>
                            <div class="mb-2">
                                <label>Spotify URL</label>
                                <input class="form-control bg-secondary text-light border-0"
                                       @bind="newTrackUrl" @bind:event="oninput"
                                       placeholder="https://open.spotify.com/playlist/..."
                                       title="Valid Spotify link required"/>
                            </div>
                            <button class="btn btn-success mt-2" @onclick="AddNewSpotifyTrack"
                                    disabled="@(!CanAddTrack)">
                                Add Spotify Track
                            </button>
                        </div>
                    }
                    else
                    {
                        <select class="form-select bg-secondary text-light border-0 mt-2" @bind="selectedTrack">
                            <option value="">-- Select Spotify Track --</option>
                            @foreach (var track in _tracks)
                            {
                                <option
                                    value="@track.Url">@(track.Name.Length > 33 ? track.Name.Substring(0, 33) + "..." : track.Name)</option>
                            }
                        </select>
                    }
                </div>

                <!-- YouTube Music Section -->
                <div class="form-section">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">▶️ YouTube Music</h5>
                        <button
                            class="btn btn-outline-light btn-sm d-flex align-items-center px-2 py-1 gap-1"
                            style="white-space: nowrap; font-size: 0.75rem; width: auto; margin-top: 0;"
                            @onclick="() => isYouTubeEditMode = !isYouTubeEditMode">
                            <i class="fa fa-pencil"></i>
                            @(isYouTubeEditMode ? "Done" : "Edit")
                        </button>
                    </div>

                    @if (isYouTubeEditMode)
                    {
                        @if (!string.IsNullOrEmpty(addYouTubeErrorMessage))
                        {
                            <div class="alert alert-danger">@addYouTubeErrorMessage</div>
                        }

                        <ul class="list-group mb-3">
                            @foreach (var entry in _youTubeCollections)
                            {
                                <li class="list-group-item bg-dark text-white px-3 py-2">
                                    <div class="row align-items-center">
                                        <div class="col-10 text-truncate">
                                            @entry.Name
                                        </div>
                                        <div class="col-2 text-end">
                                            <button class="btn btn-sm btn-outline-danger px-2 py-1 station-remove-btn"
                                                    title="Remove"
                                                    @onclick="() => RemoveYouTubeMusicEntry(entry)">
                                                <i class="fa fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </li>
                            }
                        </ul>

                        <div>
                            <div class="mb-2">
                                <label>Name</label>
                                <input class="form-control bg-secondary text-light border-0"
                                       @bind="newYouTubeName" @bind:event="oninput"
                                       placeholder="Morning Flow" />
                            </div>
                            <div class="mb-2">
                                <label>YouTube Music URL</label>
                                <input class="form-control bg-secondary text-light border-0"
                                       @bind="newYouTubeUrl" @bind:event="oninput"
                                       placeholder="https://music.youtube.com/playlist?..." />
                            </div>
                            <button class="btn btn-success mt-2" @onclick="AddNewYouTubeMusicEntry"
                                    disabled="@(!CanAddYouTubeEntry)">
                                Add YouTube Music Link
                            </button>
                        </div>
                    }
                    else
                    {
                        <select class="form-select bg-secondary text-light border-0 mt-2" @bind="selectedYouTubeEntry">
                            <option value="">-- Select YouTube Music --</option>
                            @foreach (var entry in _youTubeCollections)
                            {
                                <option value="@entry.Url">@(entry.Name.Length > 33 ? entry.Name.Substring(0, 33) + "..." : entry.Name)</option>
                            }
                        </select>
                    }
                </div>

                <hr/>

                <!-- Spotify URL Section -->
                <div class="form-section mb-5">
                    <h5 class="mb-2">🎧 Play Spotify URL</h5>
                    <input type="text" class="form-control bg-secondary text-light border-0"
                           @bind-value="spotifyUrl" @bind-value:event="oninput"
                           @onkeyup="HandleKeyPress" placeholder="Enter Spotify URL"/>
                </div>
            </div>
        }


        @if (isTimerModalOpen)
        {
            <div class="timer-modal-backdrop">
                <div class="timer-modal bg-dark text-light">
                    <div class="timer-modal-header mb-3">
                        <h5 class="timer-modal-title mb-0">⏱️ Timed Playback</h5>
                        <button type="button" class="timer-modal-close" @onclick="CloseTimerModal" title="Close">
                            <i class="fa fa-times"></i>
                            <span class="visually-hidden">Close</span>
                        </button>
                    </div>
                    <p class="text-light-emphasis small mb-3">Choose how long to play and what to listen to. Playback will stop automatically when the timer ends.</p>
                    <div class="mb-3">
                        <label class="form-label">Duration (minutes)</label>
                        <input type="number" min="1" class="form-control bg-secondary text-light border-0"
                               @bind-value="timerMinutes" @bind-value:event="oninput" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Station or Spotify</label>
                        <select class="form-select bg-secondary text-light border-0" @bind="timerSelection">
                            <option value="">-- Select Source --</option>
                            @if (_stations.Any())
                            {
                                <optgroup label="TuneIn Stations">
                                    @foreach (var station in _stations)
                                    {
                                        <option value="station|@station.Url">@(station.Name.Length > 40 ? station.Name.Substring(0, 40) + "..." : station.Name)</option>
                                    }
                                </optgroup>
                            }
                            @if (_tracks.Any())
                            {
                                <optgroup label="Spotify">
                                    @foreach (var track in _tracks)
                                    {
                                        <option value="spotify|@track.Url">@(track.Name.Length > 40 ? track.Name.Substring(0, 40) + "..." : track.Name)</option>
                                    }
                                </optgroup>
                            }
                            @if (_youTubeCollections.Any())
                            {
                                <optgroup label="YouTube Music">
                                    @foreach (var entry in _youTubeCollections)
                                    {
                                        <option value="youtube|@entry.Url">@(entry.Name.Length > 40 ? entry.Name.Substring(0, 40) + "..." : entry.Name)</option>
                                    }
                                </optgroup>
                            }
                        </select>
                    </div>
                    @if (!string.IsNullOrWhiteSpace(timerErrorMessage))
                    {
                        <div class="alert alert-danger py-2">@timerErrorMessage</div>
                    }
                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-outline-light" @onclick="CloseTimerModal">Cancel</button>
                        <button type="button" class="btn btn-success" @onclick="StartTimedPlayback">Start Timer</button>
                    </div>
                </div>
            </div>
        }



<style>
    body {
        background-color: #121212;
        color: #e0e0e0;
    }

    .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background-color: #1e1e1e;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .queue-list-container {
        max-height: 320px;
        overflow-y: auto;
    }

    .queue-list .list-group-item {
        border: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .queue-list .list-group-item:last-child {
        border-bottom: none;
    }

    .form-section {
        margin-bottom: 20px;
    }

    .form-group label {
        font-weight: bold;
        color: #bbbbbb;
    }

    .form-control, .form-select {
        background-color: #333333;
        border: 1px solid #555555;
        color: #ffffff;
        border-radius: 5px;
        padding: 10px;
    }

    .form-control:disabled {
        background-color: #333333 !important;
        color: #bbbbbb !important;
        border: 1px solid #555555 !important;
        opacity: 1; /* Prevents browsers from making it look faded */
    }

    .form-control:focus, .form-select:focus {
        border-color: #888888;
        outline: none;
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
    }

    .alert {
        border-radius: 5px;
        margin-bottom: 15px;
    }

    .timed-playback-alert {
        background: linear-gradient(135deg, #0b2538 0%, #123a52 55%, #1b5369 100%);
        border: 1px solid rgba(148, 210, 255, 0.35);
        color: #e3f6ff;
        box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.25);
        gap: 1rem;
        flex-wrap: wrap;
    }

    .timed-playback-alert > div {
        flex: 1 1 auto;
    }

    .timed-playback-alert strong {
        display: block;
        margin-bottom: 0.35rem;
        color: #f3fbff;
    }

    .timed-playback-alert p {
        color: rgba(227, 246, 255, 0.85);
    }

    .timed-playback-cancel {
        background-color: rgba(15, 76, 117, 0.35);
        border: 1px solid rgba(148, 210, 255, 0.5);
        color: #d0efff;
        padding: 0.35rem 0.95rem;
        border-radius: 999px;
        transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 0.5rem 1.2rem rgba(0, 0, 0, 0.25);
    }

    .timed-playback-cancel:hover,
    .timed-playback-cancel:focus {
        background-color: rgba(59, 130, 246, 0.25);
        border-color: rgba(148, 210, 255, 0.8);
        color: #f1fbff;
        box-shadow: 0 0.65rem 1.4rem rgba(15, 76, 129, 0.35);
    }

    .timed-playback-cancel:focus {
        outline: 2px solid rgba(148, 210, 255, 0.6);
        outline-offset: 2px;
    }

    .alert-success {
        background-color: #2e7d32;
        color: #ffffff;
        border: 1px solid #1b5e20;
    }

    .alert-warning {
        background-color: #b8860b;
        color: #ffffff;
        border: 1px solid #8b6508;
    }

    .btn {
        width: 100%;
        border-radius: 5px;
    }

    .playback-card {
        background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 55%, #0f766e 100%);
        border: none;
        color: #ffffff;
    }

    .playback-card.paused {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    }

    .playback-card .card-body {
        padding: 1.75rem;
    }

    .playback-icon {
        width: 3.25rem;
        height: 3.25rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.25);
        box-shadow: 0 0.65rem 1.2rem rgba(0, 0, 0, 0.25);
        font-size: 1.35rem;
        color: #ffffff;
    }

    .playback-text h5 {
        font-weight: 600;
    }

    .playback-text p {
        color: rgba(255, 255, 255, 0.8);
    }

    .playback-controls {
        min-width: 260px;
    }

    .playback-control-row {
        gap: 0.75rem;
        align-items: center;
    }

    .playback-action {
        width: auto;
        min-width: 2.75rem;
        padding: 0.5rem 0.9rem;
        border-radius: 0.85rem;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
        box-shadow: 0 0.6rem 1.2rem rgba(0, 0, 0, 0.25);
    }

    .playback-actions {
        justify-content: flex-end;
    }

    .playback-action:hover,
    .playback-action:focus {
        transform: translateY(-1px);
        box-shadow: 0 0.75rem 1.3rem rgba(0, 0, 0, 0.3);
    }

    .playback-volume-control {
        display: inline-flex;
        align-items: center;
        justify-content: flex-end;
        flex-wrap: wrap;
        gap: 0.65rem;
        padding: 0.45rem 0.9rem;
        border-radius: 999px;
        background: rgba(0, 0, 0, 0.25);
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.1);
    }

    .playback-volume-control i {
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.85);
    }

    .playback-volume-slider {
        width: 160px;
        min-width: 120px;
        flex: 1;
        background: transparent;
        margin: 0;
        accent-color: #ffffff;
    }

    .playback-volume-slider::-webkit-slider-runnable-track {
        height: 0.35rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.6);
    }

    .playback-volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 0.95rem;
        height: 0.95rem;
        margin-top: -0.3rem;
        border-radius: 50%;
        background: #ffffff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
        border: none;
    }

    .playback-volume-slider::-moz-range-track {
        height: 0.35rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.6);
    }

    .playback-volume-slider::-moz-range-thumb {
        width: 0.95rem;
        height: 0.95rem;
        border-radius: 50%;
        background: #ffffff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
        border: none;
    }

    .playback-volume-slider:focus {
        outline: none;
    }

    .playback-volume-value {
        font-weight: 600;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.9);
        min-width: 3rem;
        text-align: right;
    }

    .btn-danger {
        background-color: #d32f2f;
        border: 1px solid #b71c1c;
        color: #ffffff;
    }

    .btn-danger:hover {
        background-color: #b71c1c;
    }

    .btn-success {
        background-color: #388e3c;
        border: 1px solid #2e7d32;
        color: #ffffff;
    }

    .btn-success:hover {
        background-color: #2e7d32;
    }

    .list-group-item {
        border: 1px solid #555;
    }

    input.form-control.bg-secondary::placeholder {
        color: rgba(255, 255, 255, 0.6); /* soft white */
    }

    .station-remove-btn {
        background-color: #dc3545;
        color: white;
        border: none;
    }

    .station-remove-btn {
        font-size: 0.8rem;
        line-height: 1;
        padding: 2px 6px;
    }

    .btn-inline {
        width: auto !important;
        margin-top: 0 !important;
    }

    .station-remove-btn,
    .spotify-remove-btn {
        padding: 2px 8px;
        font-size: 0.75rem;
        line-height: 1;
        width: auto;
        white-space: nowrap;
    }

    .currently-playing-text {
        word-break: break-word;
        overflow-wrap: break-word;
        font-size: 0.9rem;
        max-width: 100%;
    }

    @@media (max-width: 576px) {
        .playback-card .card-body {
            padding: 1.25rem;
        }

        .playback-controls {
            min-width: 0;
            width: 100%;
            align-items: stretch !important;
        }

        .playback-control-row {
            justify-content: flex-start !important;
        }

        .playback-volume-control {
            width: 100%;
            justify-content: space-between;
        }

        .playback-volume-slider {
            min-width: 0;
            flex: 1;
        }

        .playback-volume-value {
            min-width: 0;
            text-align: right;
        }

        .currently-playing-text {
            font-size: 0.85rem;
        }
    }

    .currently-playing-text {
        word-break: break-word;
        overflow-wrap: anywhere;
        white-space: normal; /* allow wrapping */
        overflow: visible;   /* let it grow naturally */
        text-overflow: unset; /* remove ellipsis */
        max-width: 100%;
        font-size: 0.9rem;
    }

    .timer-modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.65);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1050;
        padding: 1rem;
    }

    .timer-modal {
        width: 100%;
        max-width: 420px;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 1.5rem 3rem rgba(0, 0, 0, 0.35);
    }
  
    .timer-modal-header {
        position: relative;
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
    }

    .timer-modal-title {
        flex: 1;
        font-size: 1.1rem;
    }

    .timer-modal-close {
        margin-left: auto;
        background: none;
        border: none;
        color: #bfbfbf;
        font-size: 1.1rem;
        line-height: 1;
        padding: 0.25rem;
        border-radius: 0.4rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .timer-modal-close:hover,
    .timer-modal-close:focus {
        color: #ffffff;
        background-color: rgba(255, 255, 255, 0.12);
    }

    .timer-modal-close:focus {
        outline: 2px solid rgba(255, 255, 255, 0.35);
        outline-offset: 2px;
    }


    .timer-modal .form-control,
    .timer-modal .form-select {
        background-color: #2b2b2b;
        border: 1px solid #444;
        color: #f5f5f5;
    }

    .timer-modal .form-control:focus,
    .timer-modal .form-select:focus {
        box-shadow: 0 0 0 0.2rem rgba(32, 201, 151, 0.25);
        border-color: #20c997;
    }

    .timer-modal .btn-outline-light {
        border-color: rgba(255, 255, 255, 0.4);
    }


</style>
