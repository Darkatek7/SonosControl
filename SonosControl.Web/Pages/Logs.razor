@page "/logs"
@using SonosControl.Web.Models
@inject AuthenticationStateProvider AuthenticationStateProvider
@using SonosControl.Web.Data
@inject ApplicationDbContext Db
@using SonosControl.Web.Models;

<PageTitle>System Logs</PageTitle>

<AuthorizeView Roles="admin">
    <Authorized>
        <div class="container p-4 bg-dark text-light rounded-4 shadow" style="max-width: 800px; margin-top: 3rem;">
            <h3 class="mb-4 border-bottom pb-2">📜 System Logs</h3>

            @if (logs == null)
            {
                <p>Loading logs...</p>
            }
            else if (!logs.Any())
            {
                <div class="alert alert-warning">No logs found.</div>
            }
            else
            {
                <table class="table table-dark table-hover table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>User</th>
                            <th>Action</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var log in logs)
                        {
                            <tr>
                                <td>@log.Timestamp.ToLocalTime().ToString("g")</td>
                                <td>@log.PerformedBy</td>
                                <td>@log.Action</td>
                                <td>@log.Details</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="alert alert-warning mt-4 container">
            You must be an admin to view logs.
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    private List<LogEntry>? logs;

    protected override async Task OnInitializedAsync()
    {
        logs = Db.Logs
            .OrderByDescending(l => l.Timestamp)
            .Take(100)
            .ToList();
    }
}
